import{C as S,j as e,r as u,g as T,I as j,Q as E}from"./index-VX7bsiEH.js";const M=s=>{if(!s||s.length===0)return{total:0,byDifficulty:{Easy:0,Medium:0,Hard:0},byType:{"Multiple Choice":0,"True/False":0},byDiscipline:{},avgQuality:0};const a={total:s.length,byDifficulty:{Easy:0,Medium:0,Hard:0},byType:{"Multiple Choice":0,"True/False":0},byDiscipline:{},totalQuality:0,ratedCount:0};return s.forEach(r=>{a.byDifficulty[r.difficulty]!==void 0&&a.byDifficulty[r.difficulty]++,a.byType[r.type]!==void 0&&a.byType[r.type]++,a.byDiscipline[r.discipline]||(a.byDiscipline[r.discipline]=0),a.byDiscipline[r.discipline]++;const d=parseFloat(r.critiqueScore||r.initialQuality);isNaN(d)||(a.totalQuality+=d,a.ratedCount++)}),a.avgQuality=a.ratedCount>0?(a.totalQuality/a.ratedCount).toFixed(1):0,a},p=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"],A=({questions:s})=>{const a=S.map(l=>({name:l,value:s.filter(t=>t.difficulty===l).length})).filter(l=>l.value>0),r=s.reduce((l,t)=>(l[t.discipline]=(l[t.discipline]||0)+1,l),{}),d=Object.entries(r).map(([l,t])=>({name:l,value:t})).sort((l,t)=>t.value-l.value);return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-300 mb-4 text-center",children:"Difficulty Distribution"}),e.jsx("div",{className:"h-64",children:e.jsx(ResponsiveContainer,{width:"100%",height:"100%",children:e.jsxs(PieChart,{children:[e.jsx(Pie,{data:a,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",label:({name:l,percent:t})=>`${l} ${(t*100).toFixed(0)}%`,children:a.map((l,t)=>e.jsx(Cell,{fill:p[t%p.length]},`cell-${t}`))}),e.jsx(Tooltip,{contentStyle:{backgroundColor:"#1e293b",borderColor:"#334155",color:"#f1f5f9"},itemStyle:{color:"#f1f5f9"}})]})})})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-300 mb-4 text-center",children:"Questions by Discipline"}),e.jsx("div",{className:"h-64",children:e.jsx(ResponsiveContainer,{width:"100%",height:"100%",children:e.jsxs(BarChart,{data:d,layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(CartesianGrid,{strokeDasharray:"3 3",stroke:"#334155",horizontal:!1}),e.jsx(XAxis,{type:"number",stroke:"#94a3b8"}),e.jsx(YAxis,{type:"category",dataKey:"name",stroke:"#94a3b8",width:100,tick:{fontSize:10}}),e.jsx(Tooltip,{cursor:{fill:"#334155",opacity:.4},contentStyle:{backgroundColor:"#1e293b",borderColor:"#334155",color:"#f1f5f9"}}),e.jsx(Bar,{dataKey:"value",fill:"#82ca9d",radius:[0,4,4,0],children:d.map((l,t)=>e.jsx(Cell,{fill:p[t%p.length]},`cell-${t}`))})]})})})]})]})},$=({generations:s})=>{const r=[...s].sort((d,l)=>new Date(d.timestamp)-new Date(l.timestamp)).map((d,l)=>({name:`Batch ${l+1}`,date:new Date(d.timestamp).toLocaleDateString(),quality:d.averageQuality||0,cost:(d.estimatedCost||0)*100,tokens:(d.tokensUsed?.input||0)+(d.tokensUsed?.output||0)}));return r.length===0?e.jsx("div",{className:"text-center p-8 text-slate-500",children:"Not enough data to show trends. Generate some questions first!"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-300 mb-4 text-center",children:"Average Quality Score Trend"}),e.jsx("div",{className:"h-64",children:e.jsx(ResponsiveContainer,{width:"100%",height:"100%",children:e.jsxs(LineChart,{data:r,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(CartesianGrid,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(XAxis,{dataKey:"name",stroke:"#94a3b8",tick:{fontSize:10}}),e.jsx(YAxis,{stroke:"#94a3b8",domain:[0,100]}),e.jsx(Tooltip,{contentStyle:{backgroundColor:"#1e293b",borderColor:"#334155",color:"#f1f5f9"},labelStyle:{color:"#94a3b8"}}),e.jsx(Legend,{}),e.jsx(Line,{type:"monotone",dataKey:"quality",stroke:"#8884d8",activeDot:{r:8},name:"Avg Quality Score"})]})})})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-300 mb-4 text-center",children:"Token Usage & Cost Trend"}),e.jsx("div",{className:"h-64",children:e.jsx(ResponsiveContainer,{width:"100%",height:"100%",children:e.jsxs(AreaChart,{data:r,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorTokens",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0})]})}),e.jsx(XAxis,{dataKey:"name",stroke:"#94a3b8",tick:{fontSize:10}}),e.jsx(YAxis,{stroke:"#94a3b8"}),e.jsx(CartesianGrid,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(Tooltip,{contentStyle:{backgroundColor:"#1e293b",borderColor:"#334155",color:"#f1f5f9"},labelStyle:{color:"#94a3b8"}}),e.jsx(Area,{type:"monotone",dataKey:"tokens",stroke:"#82ca9d",fillOpacity:1,fill:"url(#colorTokens)",name:"Total Tokens"})]})})}),e.jsx("p",{className:"text-[10px] text-slate-500 text-center mt-2",children:"* Cost is correlated with token usage."})]})]})},I=({questions:s})=>{const[a,r]=u.useState("overview"),[d,l]=u.useState({generations:[]}),t=u.useMemo(()=>M(s),[s]);return u.useEffect(()=>{const b=T();l(b)},[s]),!s||s.length===0?null:e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-lg p-4 mb-4 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(j,{name:"bar-chart-2",size:14})," Database Metrics"]}),e.jsxs("div",{className:"flex bg-slate-800 rounded-lg p-1 gap-1",children:[e.jsx("button",{onClick:()=>r("overview"),className:`px-3 py-1 text-[10px] font-bold uppercase rounded transition-colors ${a==="overview"?"bg-indigo-600 text-white":"text-slate-400 hover:text-slate-200"}`,children:"Overview"}),e.jsx("button",{onClick:()=>r("distributions"),className:`px-3 py-1 text-[10px] font-bold uppercase rounded transition-colors ${a==="distributions"?"bg-indigo-600 text-white":"text-slate-400 hover:text-slate-200"}`,children:"Distributions"}),e.jsx("button",{onClick:()=>r("trends"),className:`px-3 py-1 text-[10px] font-bold uppercase rounded transition-colors ${a==="trends"?"bg-indigo-600 text-white":"text-slate-400 hover:text-slate-200"}`,children:"Trends"})]})]}),e.jsxs("div",{className:"min-h-[200px]",children:[a==="overview"&&e.jsxs("div",{className:"animate-in fade-in duration-300",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t.total}),e.jsx("div",{className:"text-[10px] text-slate-400 uppercase",children:"Total Questions"})]}),e.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-400",children:t.avgQuality}),e.jsx("div",{className:"text-[10px] text-slate-400 uppercase",children:"Avg Quality"})]}),e.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-400",children:t.byType["Multiple Choice"]}),e.jsx("div",{className:"text-[10px] text-slate-400 uppercase",children:"Multiple Choice"})]}),e.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:t.byType["True/False"]}),e.jsx("div",{className:"text-[10px] text-slate-400 uppercase",children:"True/False"})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between text-[10px] text-slate-400 mb-1 uppercase font-bold",children:e.jsx("span",{children:"Difficulty Distribution"})}),e.jsxs("div",{className:"flex h-2 rounded-full overflow-hidden bg-slate-800",children:[e.jsx("div",{className:"bg-green-500",style:{width:`${t.byDifficulty.Easy/t.total*100}%`},title:`Easy: ${t.byDifficulty.Easy}`}),e.jsx("div",{className:"bg-yellow-500",style:{width:`${t.byDifficulty.Medium/t.total*100}%`},title:`Medium: ${t.byDifficulty.Medium}`}),e.jsx("div",{className:"bg-red-500",style:{width:`${t.byDifficulty.Hard/t.total*100}%`},title:`Hard: ${t.byDifficulty.Hard}`})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"})," Easy"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"})," Medium"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"})," Hard"]})]})]})})]}),a==="distributions"&&e.jsx("div",{className:"animate-in fade-in duration-300",children:e.jsx(A,{questions:s})}),a==="trends"&&e.jsx("div",{className:"animate-in fade-in duration-300",children:e.jsx($,{generations:d.generations})})]})]})},G=({questions:s,_sheetUrl:a,_onLoad:r,_onLoadFirestore:d,_onClearView:l,_onHardReset:t,onUpdateQuestion:b,onKickBack:v,_isProcessing:Q,showMessage:h,filterMode:N="all",sortBy:y="default"})=>{const[L,F]=u.useState(!1),[O,R]=u.useState(0),[_,C]=u.useState(!1),g=u.useRef(null);u.useEffect(()=>{const n=i=>{g.current&&!g.current.contains(i.target)&&C(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const m=u.useMemo(()=>{if(!s)return[];const i=[...s];switch(y){case"newest":return i.sort((o,c)=>{const f=o.createdAt||o.id||0;return(c.createdAt||c.id||0)-f});case"oldest":return i.sort((o,c)=>{const f=o.createdAt||o.id||0,x=c.createdAt||c.id||0;return f-x});case"language":return i.sort((o,c)=>(o.language||"English").localeCompare(c.language||"English"));case"discipline":return i.sort((o,c)=>(o.discipline||"").localeCompare(c.discipline||""));case"difficulty":{const o={Easy:1,Medium:2,Hard:3};return i.sort((c,f)=>(o[c.difficulty]||0)-(o[f.difficulty]||0))}case"default":default:return i}},[s,y,N]),w=u.useMemo(()=>{if(!s)return new Map;const n=new Map;return s.forEach(i=>{i.uniqueId&&(n.has(i.uniqueId)||n.set(i.uniqueId,new Set),n.get(i.uniqueId).add(i.language||"English"))}),n},[s]),D=u.useMemo(()=>{if(!s)return new Map;const n=new Map;return s.forEach(i=>{if(!i.uniqueId)return;const o=`${i.uniqueId}::${i.language||"English"}`;n.set(o,i)}),n},[s]),k=(n,i)=>{if(!n.uniqueId){h("Cannot switch: Question has no unique ID for linking translations.");return}const o=`${n.uniqueId}::${i}`,c=D.get(o);if(c){const f=m.findIndex(x=>x.id===c.id);if(f!==-1){const x=document.querySelector(`[data-question-index="${f}"]`);x&&(x.scrollIntoView({behavior:"smooth",block:"center"}),x.classList.add("ring-2","ring-green-500"),setTimeout(()=>x.classList.remove("ring-2","ring-green-500"),2e3)),h(`Scrolled to ${i} version.`)}}else h(`${i} version not found in current view. Try using "Sort by Language" to find it.`)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center bg-blue-900/20 p-4 rounded border border-blue-800/50",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold text-blue-400 flex items-center gap-2",children:[e.jsx(j,{name:"database"})," Database View"]}),e.jsxs("p",{className:"text-xs text-blue-300/70",children:["Viewing ",m.length," of ",s.length," loaded records"]})]})})}),e.jsx(I,{questions:s}),m.length===0?e.jsx("div",{className:"text-center py-10 text-slate-500",children:"No questions loaded from database. Click Refresh."}):m.map((n,i)=>e.jsx("div",{"data-question-index":i,className:"opacity-75 hover:opacity-100 transition-all",children:e.jsx(E,{q:n,onUpdateStatus:()=>{},onExplain:()=>{},onVariate:()=>{},onCritique:()=>{},onTranslateSingle:()=>{},onSwitchLanguage:o=>k(n,o),onDelete:()=>{},onUpdateQuestion:b,onKickBack:v,availableLanguages:w.get(n.uniqueId),isProcessing:!1,appMode:"database",showMessage:h})},i))]})};export{G as default};
