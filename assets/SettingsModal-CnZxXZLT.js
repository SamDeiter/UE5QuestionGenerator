import{j as e,I as t,r as y,g as z,T as R,U as v,d as C,c as A,a as U}from"./index-CbHZie7z.js";const q=({isOpen:b,title:u,message:a,confirmText:i="Confirm",cancelText:r="Cancel",onConfirm:p,onCancel:h,isDanger:s=!1})=>b?e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[200] flex items-center justify-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 p-6 rounded-xl shadow-2xl max-w-md w-full animate-in zoom-in-95 duration-300 space-y-4",children:[e.jsxs("h3",{className:`text-xl font-bold flex items-center gap-2 ${s?"text-red-500":"text-yellow-500"}`,children:[e.jsx(t,{name:s?"alert-triangle":"help-circle",size:24}),u]}),e.jsx("div",{className:"text-sm text-slate-300",children:a.split(`
`).map((x,o)=>e.jsx("p",{className:o>0?"mt-2":"",children:x},o))}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:h,className:"flex-1 px-4 py-2.5 text-sm rounded bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-colors font-medium",children:r}),e.jsx("button",{onClick:p,className:`flex-1 px-4 py-2.5 text-sm rounded font-bold transition-colors ${s?"bg-red-600 hover:bg-red-500 text-white":"bg-blue-600 hover:bg-blue-500 text-white"}`,children:i})]})]})}):null,I=({isOpen:b,title:u,message:a,placeholder:i="",expectedValue:r=null,confirmText:p="Confirm",cancelText:h="Cancel",onConfirm:s,onCancel:x,isDanger:o=!1})=>{const[d,m]=y.useState("");if(!b)return null;const g=()=>{if(r&&d!==r){alert(`Please type "${r}" exactly to confirm.`);return}s(d),m("")},f=()=>{m(""),x()};return e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[200] flex items-center justify-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 p-6 rounded-xl shadow-2xl max-w-md w-full animate-in zoom-in-95 duration-300 space-y-4",children:[e.jsxs("h3",{className:`text-xl font-bold flex items-center gap-2 ${o?"text-red-500":"text-yellow-500"}`,children:[e.jsx(t,{name:o?"alert-triangle":"help-circle",size:24}),u]}),e.jsx("p",{className:"text-sm text-slate-300 whitespace-pre-line",children:a}),e.jsx("input",{type:"text",value:d,onChange:c=>m(c.target.value),placeholder:i,className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-sm text-white focus:border-red-500 focus:ring-1 focus:ring-red-500 outline-none transition-all",autoFocus:!0,onKeyDown:c=>{c.key==="Enter"&&g(),c.key==="Escape"&&f()}}),r&&e.jsxs("p",{className:"text-xs text-slate-500",children:["Type ",e.jsx("span",{className:"font-bold text-red-400",children:r})," to confirm"]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:f,className:"flex-1 px-4 py-2 text-sm rounded bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white transition-colors font-medium",children:h}),e.jsx("button",{onClick:g,className:`flex-1 px-4 py-2 text-sm rounded font-bold transition-colors ${o?"bg-red-600 hover:bg-red-500 text-white":"bg-blue-600 hover:bg-blue-500 text-white"}`,children:p})]})]})})},$=({showSettings:b,setShowSettings:u,config:a,handleChange:i,showApiKey:r,setShowApiKey:p,onClearData:h,files:s,handleDetectTopics:x,isDetecting:o,fileInputRef:d,handleFileChange:m,removeFile:g,isApiReady:f})=>{const[c,E]=y.useState(!1),[k,w]=y.useState(!1),[S,j]=y.useState(!1);if(!b)return null;const L=z(),T=()=>{console.log("Factory Reset button clicked"),w(!0)},F=()=>{console.log("First confirm passed, showing prompt dialog..."),w(!1),j(!0)},D=async n=>{if(console.log("Prompt returned value:",n),n!=="DELETE"){console.log("User did not type DELETE correctly:",n),alert("Factory reset cancelled. You did not type 'DELETE'."),j(!1);return}console.log("User confirmed factory reset, starting..."),j(!1),E(!0);try{let l=0;console.log("Clearing Firestore...");try{l=await A(),console.log(`✅ Deleted ${l} questions from Firestore`)}catch(N){throw console.error("❌ Firestore deletion failed:",N),new Error(`Firestore deletion failed: ${N.message}`)}if(a.sheetUrl){console.log("Clearing Google Spreadsheet...");try{U(a.sheetUrl),console.log("✅ Spreadsheet clear request sent (check new tab)")}catch(N){console.error("❌ Sheets clearing failed:",N)}}else console.log("⚠️ No Sheet URL configured, skipping Sheets clear");console.log("Clearing localStorage..."),localStorage.clear(),console.log("✅ Local storage cleared"),alert(`Factory Reset Complete!

• Firestore: ${l} questions deleted
• Spreadsheet: ${a.sheetUrl?"Clearing in new tab":"Skipped (no URL)"}
• Local Storage: Cleared

Page will reload.`),console.log("Factory reset complete, reloading page..."),window.location.reload()}catch(l){console.error("❌ Factory reset error:",l),alert(`Error during factory reset:

`+l.message+`

Check console for details.`),E(!1)}};return e.jsxs("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800/50",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(t,{name:"settings",className:"text-slate-400"})," Settings"]}),e.jsx("button",{onClick:()=>u(!1),className:"text-slate-400 hover:text-white transition-colors","aria-label":"Close Settings",children:e.jsx(t,{name:"x"})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[80vh] overflow-y-auto custom-scrollbar",children:[e.jsx(R,{tokenUsage:L}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg border border-slate-700",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(t,{name:"file-text",size:16,className:"text-blue-400"}),"Source Material"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("label",{className:"text-xs font-bold uppercase text-slate-400",children:"Source Files"}),s&&s.length>0&&e.jsx("button",{onClick:x,disabled:o||!f,className:"text-[10px] flex items-center gap-1 text-indigo-400 bg-indigo-900/50 px-2 py-1 rounded border border-indigo-700/50 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"...":"Detect"})]}),e.jsxs("div",{onClick:()=>d?.current?.click(),className:"border-2 border-dashed border-slate-700 rounded p-4 hover:bg-slate-900 cursor-pointer text-center bg-slate-900/50 transition-colors",children:[e.jsx(t,{name:"upload",className:"mx-auto text-slate-600 mb-2"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Upload .csv"}),e.jsx("input",{type:"file",ref:d,onChange:m,multiple:!0,className:"hidden"})]}),s&&s.map((n,l)=>e.jsxs("div",{className:"flex justify-between bg-slate-900 p-2 rounded border border-slate-800 text-xs text-slate-400",children:[e.jsx("span",{className:"truncate",children:n.name}),e.jsx("button",{onClick:()=>g(l),className:"text-red-500 hover:text-red-400 transition-colors",children:"x"})]},l))]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1",children:v.API_KEY_LABEL}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:r?"text":"password",name:"apiKey",value:a.apiKey,onChange:i,placeholder:"AIzaSy...",className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-sm text-white focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none pr-10 transition-all"}),e.jsx("button",{onClick:()=>p(!r),className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-white transition-colors","aria-label":r?"Hide API Key":"Show API Key",children:e.jsx(t,{name:r?"eye-off":"eye",size:16})})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-1",children:"Required for generating questions. Stored locally."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1",children:v.SHEET_URL_LABEL}),e.jsx("input",{type:"text",name:"sheetUrl",value:a.sheetUrl,onChange:i,placeholder:"https://script.google.com/...",className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-sm text-white focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all"}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-1",children:"Required for Load/Export to Sheets."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1",children:"Creator Name"}),e.jsx("input",{type:"text",name:"creatorName",value:a.creatorName,onChange:i,className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-sm text-white focus:border-indigo-500 outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1",children:"Reviewer Name"}),e.jsx("input",{type:"text",name:"reviewerName",value:a.reviewerName,onChange:i,className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded text-sm text-white focus:border-indigo-500 outline-none transition-all"})]})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("label",{className:"text-xs font-bold uppercase text-slate-500",children:"Source Files (CSV)"}),s&&s.length>0&&e.jsx("button",{onClick:x,disabled:o||!f,className:"text-[10px] flex items-center gap-1 text-indigo-400 bg-indigo-900/50 px-2 py-1 rounded border border-indigo-700/50 disabled:opacity-50",children:o?"...":"Detect Topics"})]}),e.jsxs("div",{onClick:()=>d.current?.click(),className:"border-2 border-dashed border-slate-700 rounded p-4 hover:bg-slate-800 cursor-pointer text-center bg-slate-800/50 transition-colors",children:[e.jsx(t,{name:"upload",className:"mx-auto text-slate-600 mb-2"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Click to upload .csv"}),e.jsx("input",{type:"file",ref:d,onChange:m,multiple:!0,className:"hidden"})]}),s&&s.map((n,l)=>e.jsxs("div",{className:"flex justify-between bg-slate-800 p-2 rounded border border-slate-700 text-xs text-slate-400",children:[e.jsx("span",{className:"truncate",children:n.name}),e.jsx("button",{onClick:()=>g(l),className:"text-red-500 hover:text-red-400",children:e.jsx(t,{name:"x",size:14})})]},l))]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg border border-slate-700",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(t,{name:"database",size:16,className:"text-purple-400"}),"Vertex AI Training Data"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>C(!0),className:"flex-1 px-3 py-2 bg-purple-900/30 hover:bg-purple-900/50 text-purple-200 text-xs font-bold rounded border border-purple-700/50 transition-colors flex items-center justify-center gap-2",title:"Download questions with >75% score",children:[e.jsx(t,{name:"download",size:14}),"Download Good Data"]}),e.jsxs("button",{onClick:()=>C(!1),className:"flex-1 px-3 py-2 bg-slate-700/30 hover:bg-slate-700/50 text-slate-400 text-xs font-bold rounded border border-slate-600/50 transition-colors flex items-center justify-center gap-2",title:"Download questions with <75% score",children:[e.jsx(t,{name:"download",size:14}),"Download Bad Data"]})]}),e.jsxs("button",{onClick:()=>{const n=C("all");alert(`Exported ${n} total questions for training`)},className:"w-full mt-2 px-3 py-2 bg-blue-900/20 hover:bg-blue-900/30 text-blue-400 rounded flex items-center justify-center gap-2 transition-colors text-xs font-bold border border-blue-900/30",title:"Download all questions",children:[e.jsx(t,{name:"download",size:14}),"Export All Training Data"]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-2 text-center",children:"Exports JSONL format for Vertex AI fine-tuning."})]}),e.jsxs("div",{className:"bg-red-900/10 p-4 rounded-lg border border-red-900/30",children:[e.jsxs("h3",{className:"text-sm font-bold text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(t,{name:"alert-triangle",size:16}),"Danger Zone"]}),e.jsxs("button",{onClick:h,className:"w-full px-4 py-2 bg-red-900/20 hover:bg-red-900/40 text-red-400 text-sm font-bold rounded border border-red-900/50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(t,{name:"trash-2",size:16}),v.CLEAR_DATA_BTN]}),e.jsx("button",{onClick:T,disabled:c,className:"w-full mt-3 px-4 py-2 bg-red-950 hover:bg-red-900 text-red-500 text-sm font-bold rounded border border-red-900/50 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:c?e.jsxs(e.Fragment,{children:[e.jsx(t,{name:"loader",size:16,className:"animate-spin"})," Resetting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{name:"bomb",size:16})," Factory Reset (Nuke Everything)"]})}),e.jsx("p",{className:"text-[10px] text-red-400/70 mt-2 text-center",children:"Deletes ALL data: Spreadsheet + Firestore + Local Storage"})]})]})]}),e.jsx(q,{isOpen:k,title:"FACTORY RESET",message:`This will PERMANENTLY DELETE ALL data from:

• Google Spreadsheet (all Master_ sheets)
• Firestore Database (cloud)  
• Local storage (questions, settings, analytics)

This action CANNOT be undone. Continue?`,confirmText:"Yes, Continue",cancelText:"Cancel",onConfirm:F,onCancel:()=>w(!1),isDanger:!0}),e.jsx(I,{isOpen:S,title:"FINAL CONFIRMATION",message:"Type DELETE to confirm permanent deletion of ALL data:",placeholder:"Type DELETE here",expectedValue:"DELETE",confirmText:"Delete Everything",cancelText:"Cancel",onConfirm:D,onCancel:()=>j(!1),isDanger:!0})]})};export{$ as default};
